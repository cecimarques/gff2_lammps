Hello :)

Here you can find a python code (namely code.py) built for finding the CGenFF parameters for any given compound in GROMACS .itp files and outputting them in the LAMMPS format considering "real" units. The code can be adapted for any force field, with CGenFF being merely an example, AND was designed to work in conjuncture with (i) the 1-molecule LAMMPS data file that is generated by LigParGen (https://zarbi.chem.yale.edu/ligpargen)* from the compound's SMILES and (ii) the dihedral_solution_CGenFF.py code, which can also be found here and should be used subsequentially to code.py. Sample files specifically for benzene are given in the "Sample-input" directory. These go together with code.py and dihedral_solution_CGenFF.py as it is given here.

The files gmx.top, ffnonbonded.itp, ffbonded.itp and dra_ffbonded.itp found in this directory together with the python code were taken from https://cgenff.com/ by using as input a .mol2 file for bezene (this can be obtained, for example, from https://charmm-gui.org/?doc=input/ligandrm). The three latter files were used to build input files required by code.py, while information of the gmx.top file is needed to as a direct input in the file (see below).

INPUT FILES REQUIRED BY THE PYTHON CODE (9 in total):
- ffnonbonded : consists of a straightforward copy-paste of the [ atomtypes ] section of the ffnonbonded.itp file.
- ffpairtype : consists of a straightforward copy-paste of the [ pairtypes ] section of the ffnonbonded.itp file.
- ffbond : consists of a straightforward copy-paste of the [ bondtypes ] section of the ffbonded.itp and (if any) of the dra_ffbonded.itp files.
- ffangle : consists of a straightforward copy-paste of the [ angletypes ] section of the ffbonded.itp and (if any) of the dra_ffbonded.itp files.
- ffdihedral : consists of a straightforward copy-paste of the [ dihedraltypes ] section of the ffbonded.itp and (if any) of the dra_ffbonded.itp files.
- bonds: file containing the content found in the "Bonds" section of the 1-molecule LAMMPS data file output by LigParGen (edited so that the columns are separated by "\t").
- angles: file containing the content found in the "Angles" section of the 1-molecule LAMMPS data file output by LigParGen (edited so that the columns are separated by "\t").
- dihedrals: file containing the content found in the "Dihedrals" section of the 1-molecule LAMMPS data file output by LigParGen (edited so that the columns are separated by "\t").
- impropers: file containing the content found in the "Impropers" section of the 1-molecule LAMMPS data file output by LigParGen (edited so that the columns are separated by "\t").

Comments are presented along the code to assist the reader in understanding it, and an overview of the code can be found below:

 -------------------------------------------------------- CODE OVERVIEW ----------------------------------------------------
a) The first step is to find from the gmx.top file the CGenFF atom type *and* charge for each of the atom IDs in the 1-molecule LigParGen. This can be done by using OVITO to visualize the 1-molecule LAMMPS data file and figuring out the correspondence with the molecule topology in the gromacs file. These atom types and charges are then declared in the python code manually in ascending order with respect to the LAMMPS atom-IDs. 
b) The code is going to read the "ffnonbonded" file and search for the lines that concern the "atom types" for your molecule and save their associated "epsilon" and "sigma" values. These will be used to generate via mixing rules the parameters for the "regular" LJ interaction between two given atom types. The parameters for the LJ interaction specifically between 1-4 pairs is taken for each pair from the ffpairtype file and if parameters for a given pair of atom types is not listed, they are then generated using the epsilon and sigma for the given atom types and the due mixing rules. This information will be output in the python screen for each distinct pair of LAMMPS atom types: you should copy paste it in the "PairIJ Coeff" section of the LAMMPS data file. An array containing the charges is going to be saved into a file and can be easily plugged into 3rd column of the "Atoms" section (atom_style format full) of the LAMMPS data file. Note that this is done for a file that contains the 1-molecule generated by LigParGen propagated in space (the given number of molecules is an input int he code). There is also a built-in "safety check" that sums the charges of the atoms composing a molecule (should be 0 if the molecule is neutral): thet net charge of the molecule will be printed and you may check it in the kernel if you want.
c) The code reads the "bonds", "ffbond", "angles", "ffangle", "dihedrals", "ffdihedral" files and uses them to find the potential parameters underlying each bond, angle and dihedral declared in the sections of the 1-molecule LAMMPS data file gotten from LigParGen. This is done by associating the LAMMPS atom IDs for each atom with its CGenFF atom type and further finding the line in the "ffbonds", "ffangles" and "ffdihedrals" files that contain the parameters for the potential concerning the specific sequence of "atom types within OPLS-AA nomenclature". This information is also output in the kernel in a format that allows direct copying/pasting in the "Bond Coeffs" and "Angle Coeffs" in the case of bond and angle potentials, except that you need to manually delete repeated lines that are output by the code when the given bond or angle is formed by a palindrome sequence, which the code outputs twice by construction. The information concerning dihedral potentials should be copied-pasted into a new file named dihedralcoeff which will be used as input for the code dihedral_solution_CGenFF.py (see next item) as more processing than the one previously mentioned is needed.
d) You need to run the code dihedral_solution_CGenFF.py. This code does several things: first, it tackles the deletion of repeated lines mentioned in item c for the dihedrals. Secondly it will identify lines in the dihedralcoeff that concern a same dihedral type but have different parameters, assign these new dihedral types and then repeat the dihedral of the old type in the Dihedrals section while assigning them this new type: as it turns out, CGenFF requires in some cases that more than one potential of the form given in https://docs.lammps.org/dihedral_charmm.html is tuned for a *same* dihedral, which I am tackling as previously mentioned. Thirdly, the code is going to identify if dihedral potential parameters is missing for a given dihedral type, which should be either (i) due to the sequence of atom types having a "X" in the ffdihedral file due to the specific atom type being unimportant for the parameters *OR* (ii) due to no dihedral for the given specific sequence of atom types not existing, case in which potentials with force constants equal to 0 can be tuned. Fourthly, the code sets the "w" parameter for each dihedral potential of the form given in https://docs.lammps.org/dihedral_charmm.html accordingly: these must be always 1 except for dihedral types that share the 1 and 4 atoms with another dihedral types (this can happen in cyclic molecules or, obviously, in case we have more than one dihedral type tuned over a same dihedral sequence).

The .py code takes care of all necessary unit conversions required in the process of transforming GROMACS potential parameters to LAMMPS potential parameters for a LAMMPS input script that contemplates units "real". It also accounts for the differences in the potential form as implemented in GROMACS and LAMMPS (e.g., sometimes a pre-factor of 1/2 exists). More specifically, the parameters are set to go along with an input script that cherishes the following setup:
pair_style      lj/charmmfsw/coul/long 10 12

kspace_style    pppm 1e-6


bond_style      harmonic

angle_style     charmm

dihedral_style  charmmfsw

special_bonds   charmm

improper_style  harmonic

 -----------------------------------------------------------------------------------------------------------------------------
d) Finally, for impropers, the code simply outputs the list of atom types underlying each improper declared in the "Impropers" section in the 1-molecule LAMMPS data file obtained from LigParGen. It is responsibility of the user to see, based on the sequence of atom types underlying each improper, if it is necessary to set an improper potential for any of the impropers by searching in the ffimproper file. Note that adaptations in terms of changes in potential form from GROMACS-to-LAMMPS and unit conversion will also need to be done by the user.

Hope you can find it useful !

- Cecilia Alvares
